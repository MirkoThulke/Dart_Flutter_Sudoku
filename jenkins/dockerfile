# ------------------------------------------------------------
# Build image with specific tag:
# ------------------------------------------------------------
#   docker build -t jenkins_sudoku_image:2.528.3 .
#   docker build --no-cache -t jenkins_sudoku_image:2.528.3 .
# ------------------------------------------------------------


# ------------------------------------------------------------
# Install minimal dependencies + Docker CLI
# ------------------------------------------------------------
# Base image, Pin to specific LTS version for stability

FROM jenkins/jenkins:2.528.3-lts-jdk21

USER root

# Change UID/GID to 2000
RUN usermod -u 2000 jenkins \
 && groupmod -g 2000 jenkins

# Disable setup wizard
ENV JAVA_OPTS="-Djenkins.install.runSetupWizard=false"

# Jenkins home (standard)
ENV JENKINS_HOME=/var/jenkins_home

# Create workspace directory explicitly
RUN mkdir -p /workspace \
 && chown -R 2000:2000 /workspace


COPY init.groovy.d/ /usr/share/jenkins/ref/init.groovy.d/

# Install dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
        docker-cli \
        ca-certificates \
        curl \
        git \
    && rm -rf /var/lib/apt/lists/*

# Install plugins
RUN jenkins-plugin-cli --plugins \
    git \
    workflow-aggregator \
    github \
    github-branch-source \
    pipeline-stage-view

USER jenkins
