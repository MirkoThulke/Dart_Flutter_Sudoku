# ------------------------------------------------------------
# Build image:
#   docker build -t jenkins:latest .
#   docker build --no-cache -t jenkins:latest .
# ------------------------------------------------------------


# ------------------------------------------------------------
# Install minimal dependencies + Docker CLI
# ------------------------------------------------------------

FROM jenkins/jenkins:lts

USER root

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        docker-cli \
        ca-certificates \
        curl \
        git \
        tini \
    && rm -rf /var/lib/apt/lists/*

# Allow Jenkins to access docker socket
RUN groupadd -f docker && usermod -aG docker jenkins

# Ensure docker is discoverable
ENV PATH="/usr/bin:/usr/local/bin:$PATH"

ENTRYPOINT ["/usr/bin/tini", "--"]
CMD ["/usr/local/bin/jenkins.sh"]

USER jenkins
